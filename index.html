<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>氣象局網站資料</title>
  <script src="node_modules/jquery/dist/jquery.min.js"></script>
  <link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css">
  <style>
    div {
      margin: 5px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="row">
      <div class="col-6">
        <select id="citySelected" name="citySelected"></select>
      </div>
    </div>
    <div class="row" id="threeDaysWeather">
      <div class="col-3" style="background-color: lightblue;" id="today"></div>
      <div class="col-3" style="background-color: lightblue;" id="tomorrow"></div>
      <div class="col-3" style="background-color: lightblue;" id="afterTomorrow"></div>
    </div>
  </div>
</body>

<script>
  $(document).ready(function () {
    $.ajax({
      type: "GET",
      url: "myApi.php"
    }).then(function(dataFromServer) {
      let data = JSON.parse(dataFromServer);
      console.log(data);
      $("#citySelected").append("<option value='-1' selected>--</option>");
      for(let oneData of data) {
        let appendItem = $("<option></option>").prop("value", oneData["cityId"]).append(oneData["cityName"]);
        $("#citySelected").append(appendItem);
      }
    }).catch(function(e) {
      console.log(e);
    })

    $("#citySelected").on("change", function() {
      let cityId = $("#citySelected").prop('value');
      $.ajax({
        type: "GET",
        url: `myApi.php?cityId=${cityId}`
      }).then(function(dataFromServer){
        let data = JSON.parse(dataFromServer);
        console.log(data);
        $("#today").empty();
        $("#tomorrow").empty();
        $("#afterTomorrow").empty();
        $("#today").append("時間: " + data[0].startTime + "<br>");
        $("#today").append(data[0].wx + "<br>");
        $("#today").append("溫度: " + data[0].minT + " - " + data[0].maxT + " 攝氏度<br>");
        $("#today").append("體感溫度: " + data[0].minAT + " - " + data[0].maxAT + " 攝氏度<br>");
        $("#today").append("降雨機率: " + data[0].pop12h + " %<br>");
        $("#today").append("風速: " + data[0].ws1 + " 級風<br>");
        $("#today").append("風向: " + data[0].wd);

        $("#tomorrow").append("時間: " + data[2].startTime + "<br>");
        $("#tomorrow").append(data[2].wx + "<br>");
        $("#tomorrow").append("溫度: " + data[2].minT + " - " + data[2].maxT + " 攝氏度<br>");
        $("#tomorrow").append("體感溫度: " + data[2].minAT + " - " + data[2].maxAT + " 攝氏度<br>");
        $("#tomorrow").append("降雨機率: " + data[2].pop12h + " %<br>");
        $("#tomorrow").append("風速: " + data[2].ws1 + " 級風<br>");
        $("#tomorrow").append("風向: " + data[2].wd);

        $("#afterTomorrow").append("時間: " + data[4].startTime + "<br>");
        $("#afterTomorrow").append(data[4].wx + "<br>");
        $("#afterTomorrow").append("溫度: " + data[4].minT + " - " + data[4].maxT + " 攝氏度<br>");
        $("#afterTomorrow").append("體感溫度: " + data[4].minAT + " - " + data[4].maxAT + " 攝氏度<br>");
        $("#afterTomorrow").append("降雨機率: " + data[4].pop12h + " %<br>");
        $("#afterTomorrow").append("風速: " + data[4].ws1 + " 級風<br>");
        $("#afterTomorrow").append("風向: " + data[4].wd);
      }).catch(function(e){

      })
    })
  });
</script>

</html>